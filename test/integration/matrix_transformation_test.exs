defmodule Rock.Integration.MatrixTransformationTest do
  use ExUnit.Case
  alias Rock.Struct.Point
  alias Rock.JaccardCoefficient

  test "creates similarity matrix with jaccard coefficient measure" do
    points = [
      Point.new(["1", "2", "3"]),
      Point.new(["1", "2", "4"]),
      Point.new(["1", "2", "5"]),
      Point.new(["1", "3", "4"]),
      Point.new(["1", "3", "5"]),
      Point.new(["1", "4", "5"]),
      Point.new(["2", "3", "4"]),
      Point.new(["2", "3", "5"]),
      Point.new(["2", "4", "5"]),
      Point.new(["3", "4", "5"]),
      Point.new(["1", "2", "6"]),
      Point.new(["1", "2", "7"]),
      Point.new(["1", "6", "7"]),
      Point.new(["2", "6", "7"])
    ]

    matrix =
      points
      |> Enum.map(fn point1 ->
        points
        |> Enum.map(fn point2 ->
          JaccardCoefficient.measure(point1, point2)
        end)
      end)

    [
      [1.0, 0.5, 0.5, 0.5, 0.5, 0.2, 0.5, 0.5, 0.2, 0.2, 0.5, 0.5, 0.2, 0.2],
      [0.5, 1.0, 0.5, 0.5, 0.2, 0.5, 0.5, 0.2, 0.5, 0.2, 0.5, 0.5, 0.2, 0.2],
      [0.5, 0.5, 1.0, 0.2, 0.5, 0.5, 0.2, 0.5, 0.5, 0.2, 0.5, 0.5, 0.2, 0.2],
      [0.5, 0.5, 0.2, 1.0, 0.5, 0.5, 0.5, 0.2, 0.2, 0.5, 0.2, 0.2, 0.2, 0.0],
      [0.5, 0.2, 0.5, 0.5, 1.0, 0.5, 0.2, 0.5, 0.2, 0.5, 0.2, 0.2, 0.2, 0.0],
      [0.2, 0.5, 0.5, 0.5, 0.5, 1.0, 0.2, 0.2, 0.5, 0.5, 0.2, 0.2, 0.2, 0.0],
      [0.5, 0.5, 0.2, 0.5, 0.2, 0.2, 1.0, 0.5, 0.5, 0.5, 0.2, 0.2, 0.0, 0.2],
      [0.5, 0.2, 0.5, 0.2, 0.5, 0.2, 0.5, 1.0, 0.5, 0.5, 0.2, 0.2, 0.0, 0.2],
      [0.2, 0.5, 0.5, 0.2, 0.2, 0.5, 0.5, 0.5, 1.0, 0.5, 0.2, 0.2, 0.0, 0.2],
      [0.2, 0.2, 0.2, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 1.0, 0.0, 0.0, 0.0, 0.0],
      [0.5, 0.5, 0.5, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.0, 1.0, 0.5, 0.5, 0.5],
      [0.5, 0.5, 0.5, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.0, 0.5, 1.0, 0.5, 0.5],
      [0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.0, 0.0, 0.0, 0.0, 0.5, 0.5, 1.0, 0.5],
      [0.2, 0.2, 0.2, 0.0, 0.0, 0.0, 0.2, 0.2, 0.2, 0.0, 0.5, 0.5, 0.5, 1.0]
    ] = matrix
  end
end
